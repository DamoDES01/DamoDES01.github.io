<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Feuille de pointage Tir à l'Arc</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { padding: 5px; text-align: center; }
    th { background: #f0f0f0; }
    .score-input { 
      width: 50px; 
      height: 50px; 
      font-size: 20px; 
      text-align: center;
    }
    .sum-cell, .cumulative-cell {
      width: 80px;
      font-weight: bold;
      font-size: 18px;
    }
    .keyboard {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .key {
      padding: 20px;
      background: #eee;
      border: 1px solid #ccc;
      font-size: 24px;
      text-align: center;
      border-radius: 8px;
      user-select: none;
    }
    .key:active {
      background: #ccc;
    }
    button {
      margin-top: 20px;
      padding: 10px;
      width: 100%;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h1>Feuille de pointage - Tir à l'arc</h1>

<table id="scoreTable"></table>

<div id="stats" style="margin-top: 30px; font-size: 20px;">
  <div id="count10"># 10 : 0</div>
  <div id="count9"># 9 : 0</div>
  <div id="totalArrows">Total 60 flèches : 0</div>
</div>

<div class="keyboard" id="keyboard">
  <div class="key">M</div>
  <div class="key">1</div>
  <div class="key">2</div>
  <div class="key">3</div>
  <div class="key">4</div>
  <div class="key">5</div>
  <div class="key">6</div>
  <div class="key">7</div>
  <div class="key">8</div>
  <div class="key">9</div>
  <div class="key">10</div>
  <div class="key">X</div>
</div>

<h2 id="totalResult"></h2>

<script>
  const table = document.getElementById('scoreTable');
  const scoreInputsLeft = [];
  const scoreInputsRight = [];
  const sumCellsLeft = [];
  const cumulCellsLeft = [];
  const sumCellsRight = [];
  const cumulCellsRight = [];

  let currentInputIndex = 0; // advance properly across left first, then right

  // Create table header
  const header = document.createElement('tr');
  header.innerHTML = `
    <th></th>
    <th colspan="3">3 flèches/volée</th>
    <th>Volée</th>
    <th>Cumul</th>
    <th></th>
    <th colspan="3">3 flèches/volée</th>
    <th>Volée</th>
    <th>Cumul</th>
  `;
  table.appendChild(header);

  // Create table rows
  for (let i = 0; i < 10; i++) {
    const row = document.createElement('tr');

    // Line number (left 1 to 10)
    const lineLeft = document.createElement('td');
    lineLeft.textContent = (i + 1).toString();
    row.appendChild(lineLeft);

    // 3 arrow inputs (left)
    for (let j = 0; j < 3; j++) {
      const td = document.createElement('td');
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'score-input';
      input.readOnly = true;
      input.dataset.index = scoreInputsLeft.length;
      scoreInputsLeft.push(input);
      td.appendChild(input);
      row.appendChild(td);
    }

    // Volée (sum of 3 arrows - left)
    const sumLeft = document.createElement('td');
    sumLeft.className = 'sum-cell';
    sumLeft.textContent = '0';
    sumCellsLeft.push(sumLeft);
    row.appendChild(sumLeft);

    // Cumul (cumulative sum - left)
    const cumulLeft = document.createElement('td');
    cumulLeft.className = 'cumulative-cell';
    cumulLeft.textContent = i === 0 ? '' : '0';
    cumulCellsLeft.push(cumulLeft);
    row.appendChild(cumulLeft);

    // Spacer between left and right
    const spacer = document.createElement('td');
    row.appendChild(spacer);

    // Line number (right 11 to 20)
    const lineRight = document.createElement('td');
    lineRight.textContent = (i + 11).toString();
    row.appendChild(lineRight);

    // 3 arrow inputs (right)
    for (let j = 0; j < 3; j++) {
      const td = document.createElement('td');
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'score-input';
      input.readOnly = true;
      input.dataset.index = scoreInputsRight.length;
      scoreInputsRight.push(input);
      td.appendChild(input);
      row.appendChild(td);
    }

    // Volée (sum of 3 arrows - right)
    const sumRight = document.createElement('td');
    sumRight.className = 'sum-cell';
    sumRight.textContent = '0';
    sumCellsRight.push(sumRight);
    row.appendChild(sumRight);

    // Cumul (cumulative sum - right)
    const cumulRight = document.createElement('td');
    cumulRight.className = 'cumulative-cell';
    cumulRight.textContent = i === 0 ? '' : '0';
    cumulCellsRight.push(cumulRight);
    row.appendChild(cumulRight);

    table.appendChild(row);
  }

  const allInputs = [...scoreInputsLeft, ...scoreInputsRight]; // Correct input order

  allInputs.forEach((input, index) => {
    input.addEventListener('click', () => {
      currentInputIndex = index;
    });
  });

  const keyboard = document.getElementById('keyboard');
  keyboard.addEventListener('click', function(event) {
    if (event.target.classList.contains('key')) {
      const value = event.target.textContent;
      if (currentInputIndex < allInputs.length) {
        allInputs[currentInputIndex].value = value;
        currentInputIndex++;
        if (currentInputIndex < allInputs.length) {
          allInputs[currentInputIndex].focus();
        }
        calculateTotals();
      }
    }
  });

function calculateTotals() {
  let totalScore = 0;
  let count10 = 0;
  let count9 = 0;

  // LEFT sums
  for (let i = 0; i < 10; i++) {
    let sum = 0;
    for (let j = 0; j < 3; j++) {
      const value = scoreInputsLeft[i * 3 + j].value.toUpperCase();
      if (value === 'M') {
        sum += 0;
      } else if (value === 'X') {
        sum += 10;
        count10++;
      } else if (!isNaN(parseInt(value))) {
        const num = parseInt(value);
        sum += num;
        if (num === 10) count10++;
        if (num === 9) count9++;
      }
    }
    sumCellsLeft[i].textContent = sum;
  }

  // LEFT cumulative
  let cumulLeft = 0;
  for (let i = 0; i < 10; i++) {
    cumulLeft += parseInt(sumCellsLeft[i].textContent);
    if (i !== 0) cumulCellsLeft[i].textContent = cumulLeft;
  }

  // RIGHT sums
  for (let i = 0; i < 10; i++) {
    let sum = 0;
    for (let j = 0; j < 3; j++) {
      const value = scoreInputsRight[i * 3 + j].value.toUpperCase();
      if (value === 'M') {
        sum += 0;
      } else if (value === 'X') {
        sum += 10;
        count10++;
      } else if (!isNaN(parseInt(value))) {
        const num = parseInt(value);
        sum += num;
        if (num === 10) count10++;
        if (num === 9) count9++;
      }
    }
    sumCellsRight[i].textContent = sum;
  }

  // RIGHT cumulative
  let cumulRight = 0;
  for (let i = 0; i < 10; i++) {
    cumulRight += parseInt(sumCellsRight[i].textContent);
    if (i !== 0) cumulCellsRight[i].textContent = cumulRight;
  }

  // TOTAL
  allInputs.forEach(input => {
    const value = input.value.toUpperCase();
    if (value === 'M') {
      totalScore += 0;
    } else if (value === 'X') {
      totalScore += 10;
    } else if (!isNaN(parseInt(value))) {
      totalScore += parseInt(value);
    }
  });

  document.getElementById('totalResult').textContent = 'Score Total: ' + totalScore;
  document.getElementById('count10').textContent = '# 10 : ' + count10;
  document.getElementById('count9').textContent = '# 9 : ' + count9;
  document.getElementById('totalArrows').textContent = 'Total 60 flèches : ' + totalScore;
}

</script>

</body>
</html>
